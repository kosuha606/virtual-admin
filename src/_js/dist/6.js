(window.webpackJsonp=window.webpackJsonp||[]).push([[6,9],{"+Dyb":function(t,e,n){"use strict";n.r(e);var a={name:"DetailField",props:["component"],methods:{onAdditionalChange:function(t){this.component.additionalValues=t}}},i=n("KHd+"),o=Object(i.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"virtual-form-row"},[n(t.component.component,{tag:"component",attrs:{field:t.component.field,props:t.component.props,label:t.component.label,"additional-values":t.component.additionalValues},on:{additionalchange:t.onAdditionalChange},model:{value:t.component.value,callback:function(e){t.$set(t.component,"value",e)},expression:"component.value"}})],1)}),[],!1,null,"3b7edfbc",null);e.default=o.exports},"+hgu":function(t,e,n){"use strict";(function(t){var a=n("LvDl"),i=n("+Dyb");e.a={name:"Detail",props:{id:[String,Number],tabPrefix:String,restoreMode:Boolean,hideViewOnly:Boolean,defaultFormData:Object,detailConfig:Object,saveUrl:String,detailComponents:Array,additionalComponents:Array,component:void 0,item:Object},components:{DetailField:i.default},created:function(){var t=this;Object(a.each)(this.detailComponents,(function(e){t.formData[e.field]=e})),this.$forceUpdate()},mounted:function(){t(document).ready((function(){var e=window.location.hash;e&&(e=e.replace("-tab",""),t('[href="'+e+'"]').trigger("click")),t(".nav-tabs a").on("shown.bs.tab",(function(t){window.location.hash=t.target.hash+"-tab"}))}))},computed:{componentsIndex:function(){var t={};return Object(a.each)(this.detailComponents,(function(e){t[e.field]=e})),t},listUrl:function(){return this.saveUrl.replace("detail","list")},deleteUrl:function(){return this.saveUrl.replace("detail","delete")}},data:function(){return{liveCounter:1,isSuccess:!1,isError:!1,alertMessage:"",formData:{}}},methods:{checkInput:function(){console.log("input")},back:function(){location.href=this.listUrl+"?list=on"},save:function(){var t=this;this.uploadToServer((function(){t.back()}))},apply:function(){this.uploadToServer()},processError:function(e){var n="";Object(a.each)(e,(function(t){n+=t+"<br>"})),this.alert(n,"error"),t("html, body").animate({scrollTop:0},"slow")},deleteItem:function(){var e=this;confirm("Вы уверены?")&&(this.$root.startProgress(),t.ajax({method:"POST",url:this.saveUrl,data:{id:this.id,delete:!0}}).done((function(t){t.result?e.back():e.alert("Ошибка удаления","error"),e.$root.stopProgress()})).fail((function(){e.$root.stopProgress()})))},alert:function(t,e){this.isError=!1,this.isSuccess=!1,"success"===e?this.isSuccess=!0:this.isError=!0,this.alertMessage=t,this.$forceUpdate()},addAdditionalData:function(t,e){this.additionalComponents[t].dataConfig.push(Object(a.cloneDeep)(e)),this.liveCounter++,this.$forceUpdate()},deleteAdditionalData:function(t,e){this.additionalComponents[t].dataConfig.splice(e,1),this.liveCounter++,this.$forceUpdate()},appendAdditionalData:function(t){var e={};return Object(a.each)(this.additionalComponents,(function(t){t.isViewOnly||(e[t.relationClass]||(e[t.relationClass]=[]),Object(a.each)(t.dataConfig,(function(n){var i={};Object(a.each)(n,(function(t){i[t.field]=t.value})),e[t.relationClass].push(i)})))})),t.secondary_form=e,t},appendAdditionalDataFromReqularComponents:function(t,e){return Object(a.each)(t,(function(t){t.additionalValues&&e.secondary_form&&(e.secondary_form[t.additionalValues.relationClass]||(e.secondary_form[t.additionalValues.relationClass]=[]),Object(a.each)(t.additionalValues.items,(function(n){var i={};Object(a.each)(n,(function(t){i[t.field]=t.value})),e.secondary_form[t.additionalValues.relationClass].push(i)})))})),e},uploadToServer:function(e){var n=this;this.$root.startProgress();var i={};this.id&&(i.id=this.id),Object(a.each)(this.formData,(function(t){i[t.field]=t.value})),Object(a.each)(this.defaultFormData,(function(t,e){i[e]=t})),this.item.id&&(i=this.appendAdditionalData(i)),i=this.appendAdditionalDataFromReqularComponents(this.formData,i),this.additionalComponents&&Object(a.each)(this.additionalComponents,(function(t){Object(a.each)(t.dataConfig,(function(t){i=n.appendAdditionalDataFromReqularComponents(t,i)}))})),t.ajax({method:"POST",url:this.saveUrl,data:i}).done((function(t){if(t.result)if(e)e();else{var a=n.saveUrl+"?id="+t.model.id;location.hash&&(a=a+"#"+location.hash),location.reload()}else n.processError(t.errors);n.$root.stopProgress()})).fail((function(){n.$root.stopProgress()}))}}}}).call(this,n("EVdn"))},"KHd+":function(t,e,n){"use strict";function a(t,e,n,a,i,o,s,r){var l,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=n,d._compiled=!0),a&&(d.functional=!0),o&&(d._scopeId="data-v-"+o),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},d._ssrRegister=l):i&&(l=r?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(t,e){return l.call(e),c(t,e)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:d}}n.d(e,"a",(function(){return a}))},jAuM:function(t,e,n){"use strict";n.r(e);var a=n("+hgu").a,i=n("KHd+"),o=Object(i.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.detailConfig.noback||t.restoreMode?t._e():n("div",[n("button",{staticClass:"btn btn-default",on:{click:t.back}},[n("i",{staticClass:"fa fa-arrow-left"}),t._v("\n            Назад\n        ")])]),t._v(" "),t.restoreMode?t._e():n("hr"),t._v(" "),t.alertMessage?n("div",{class:{alert:1,"alert-success":t.isSuccess,"alert-danger":t.isError}},[n("div",{domProps:{innerHTML:t._s(t.alertMessage)}})]):t._e(),t._v(" "),t.detailConfig.notabs?t._e():n("ul",{staticClass:"nav nav-tabs"},[n("li",{staticClass:"nav-item active"},[n("a",{staticClass:"nav-link active",attrs:{"data-toggle":"tab",href:"#"+t.tabPrefix+"description"}},[t._v("Основное")])]),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(e){return!0!==e.isViewOnly||!0!==t.hideViewOnly?n("li",{staticClass:"nav-item"},[n("a",{staticClass:"nav-link",attrs:{"data-toggle":"tab",href:"#"+t.tabPrefix+e.tabLink}},[t._v(t._s(e.tab))])]):t._e()})):t._e()],2),t._v(" "),n("div",{staticClass:"tab-content"},[n("p",[t._v(" ")]),t._v(" "),n("div",{staticClass:"tab-pane fade active show",attrs:{id:t.tabPrefix+"description"}},[n("div",{staticClass:"form"},[t._t("default",[t._l(t.formData,(function(t,e){return[n("div",[n("detail-field",{key:"main_data_field"+e,attrs:{component:t}})],1)]}))],{default:t.formData})],2)]),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(e,a){return!0!==e.isViewOnly||!0!==t.hideViewOnly?n("div",{staticClass:"tab-pane fade",attrs:{id:t.tabPrefix+e.tabLink}},["one.to.one"!==e.type?n("div",[t._l(e.dataConfig,(function(i,o){return n("div",[e.isViewOnly?t._e():n("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(e){return t.deleteAdditionalData(a,o)}}},[t._v("Удалить")]),t._v(" "),t._l(i,(function(e,a){return[n("div",[n("detail-field",{key:"data_component"+a+"_"+t.liveCounter,ref:"detail_field_"+e.field+"_"+a+"_"+o,refInFor:!0,attrs:{"data-index":o,index:a,component:e}})],1)]})),t._v(" "),n("hr")],2)})),t._v(" "),e.isViewOnly?t._e():n("button",{staticClass:"btn btn-primary",staticStyle:{"margin-top":"10px"},attrs:{type:"button"},on:{click:function(n){return t.addAdditionalData(a,e.initialConfig)}}},[t._v("Добавить")])],2):n("div",t._l(e.dataConfig,(function(e){return n("div",[t._l(e,(function(t,e){return[n("div",[n("detail-field",{key:"data_component"+e,attrs:{component:t}})],1)]}))],2)})),0)]):t._e()})):t._e()],2),t._v(" "),n("p",[t._v(" ")]),t._v(" "),t.detailConfig.nobuttons?t._e():n("div",[t.restoreMode?t._e():n("button",{staticClass:"btn btn-success",on:{click:t.save}},[n("i",{staticClass:"fa fa-save"}),t._v("\n            Сохранить\n        ")]),t._v(" "),n("button",{staticClass:"btn btn-primary",on:{click:t.apply}},[t.restoreMode?[t._v("\n                Восстановить\n            ")]:[t._v("\n                Применить\n            ")]],2),t._v(" "),this.id&&!t.restoreMode?n("button",{staticClass:"btn btn-danger",on:{click:t.deleteItem}},[t._v("\n            Удалить\n        ")]):t._e()])])}),[],!1,null,"37974258",null);e.default=o.exports}}]);
//# sourceMappingURL=6.js.map