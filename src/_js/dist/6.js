(window.webpackJsonp=window.webpackJsonp||[]).push([[6,9],{"+Dyb":function(t,n,e){"use strict";e.r(n);var a={name:"DetailField",props:["component"],methods:{onAdditionalChange:function(t){this.component.additionalValues=t}}},i=e("KHd+"),o=Object(i.a)(a,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"virtual-form-row"},[e(t.component.component,{tag:"component",attrs:{field:t.component.field,props:t.component.props,label:t.component.label,"additional-values":t.component.additionalValues},on:{additionalchange:t.onAdditionalChange},model:{value:t.component.value,callback:function(n){t.$set(t.component,"value",n)},expression:"component.value"}})],1)}),[],!1,null,"3b7edfbc",null);n.default=o.exports},"+hgu":function(t,n,e){"use strict";(function(t){var a=e("LvDl"),i=e("+Dyb");n.a={name:"Detail",props:{id:[String,Number],defaultFormData:Object,detailConfig:Object,saveUrl:String,detailComponents:Array,additionalComponents:Array,component:void 0,item:Object},components:{DetailField:i.default},created:function(){var t=this;Object(a.each)(this.detailComponents,(function(n){t.formData[n.field]=n})),this.$forceUpdate()},mounted:function(){t(document).ready((function(){var n=window.location.hash;n&&(n=n.replace("-tab",""),t('[href="'+n+'"]').trigger("click")),t(".nav-tabs a").on("shown.bs.tab",(function(t){window.location.hash=t.target.hash+"-tab"}))}))},computed:{componentsIndex:function(){var t={};return Object(a.each)(this.detailComponents,(function(n){t[n.field]=n})),t},listUrl:function(){return this.saveUrl.replace("detail","list")},deleteUrl:function(){return this.saveUrl.replace("detail","delete")}},data:function(){return{isSuccess:!1,isError:!1,alertMessage:"",formData:{}}},methods:{checkInput:function(){console.log("input")},back:function(){location.href=this.listUrl+"?list=on"},save:function(){var t=this;this.uploadToServer((function(){t.back()}))},apply:function(){this.uploadToServer()},processError:function(n){var e="";Object(a.each)(n,(function(t){e+=t+"<br>"})),this.alert(e,"error"),t("html, body").animate({scrollTop:0},"slow")},deleteItem:function(){var n=this;confirm("Вы уверены?")&&(this.$root.startProgress(),t.ajax({method:"POST",url:this.saveUrl,data:{id:this.id,delete:!0}}).done((function(t){t.result?n.back():n.alert("Ошибка удаления","error"),n.$root.stopProgress()})).fail((function(){n.$root.stopProgress()})))},alert:function(t,n){this.isError=!1,this.isSuccess=!1,"success"===n?this.isSuccess=!0:this.isError=!0,this.alertMessage=t,this.$forceUpdate()},addAdditionalData:function(t,n){this.additionalComponents[t].dataConfig.push(Object(a.cloneDeep)(n)),this.$forceUpdate()},deleteAdditionalData:function(t,n){this.additionalComponents[t].dataConfig.splice(n,1),this.$forceUpdate()},appendAdditionalData:function(t){var n={};return Object(a.each)(this.additionalComponents,(function(t){t.isViewOnly||(n[t.relationClass]||(n[t.relationClass]=[]),Object(a.each)(t.dataConfig,(function(e){var i={};Object(a.each)(e,(function(t){i[t.field]=t.value})),n[t.relationClass].push(i)})))})),t.secondary_form=n,t},appendAdditionalDataFromReqularComponents:function(t,n){return Object(a.each)(t,(function(t){t.additionalValues&&n.secondary_form&&(n.secondary_form[t.additionalValues.relationClass]||(n.secondary_form[t.additionalValues.relationClass]=[]),Object(a.each)(t.additionalValues.items,(function(e){var i={};Object(a.each)(e,(function(t){i[t.field]=t.value})),n.secondary_form[t.additionalValues.relationClass].push(i)})))})),n},uploadToServer:function(n){var e=this;this.$root.startProgress();var i={};this.id&&(i.id=this.id),Object(a.each)(this.formData,(function(t){i[t.field]=t.value})),Object(a.each)(this.defaultFormData,(function(t,n){i[n]=t})),this.item.id&&(i=this.appendAdditionalData(i)),i=this.appendAdditionalDataFromReqularComponents(this.formData,i),this.additionalComponents&&Object(a.each)(this.additionalComponents,(function(t){Object(a.each)(t.dataConfig,(function(t){i=e.appendAdditionalDataFromReqularComponents(t,i)}))})),t.ajax({method:"POST",url:this.saveUrl,data:i}).done((function(t){if(t.result)if(n)n();else{var a=e.saveUrl+"?id="+t.model.id;location.hash&&(a=a+"#"+location.hash),location.reload()}else e.processError(t.errors);e.$root.stopProgress()})).fail((function(){e.$root.stopProgress()}))}}}}).call(this,e("EVdn"))},"KHd+":function(t,n,e){"use strict";function a(t,n,e,a,i,o,s,r){var l,c="function"==typeof t?t.options:t;if(n&&(c.render=n,c.staticRenderFns=e,c._compiled=!0),a&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=l):i&&(l=r?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,n){return l.call(n),d(t,n)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:c}}e.d(n,"a",(function(){return a}))},jAuM:function(t,n,e){"use strict";e.r(n);var a=e("+hgu").a,i=e("KHd+"),o=Object(i.a)(a,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[t.detailConfig.noback?t._e():e("div",[e("button",{staticClass:"btn btn-default",on:{click:t.back}},[e("i",{staticClass:"fa fa-arrow-left"}),t._v("\n            Назад\n        ")])]),t._v(" "),e("hr"),t._v(" "),t.alertMessage?e("div",{class:{alert:1,"alert-success":t.isSuccess,"alert-danger":t.isError}},[e("div",{domProps:{innerHTML:t._s(t.alertMessage)}})]):t._e(),t._v(" "),t.detailConfig.notabs?t._e():e("ul",{staticClass:"nav nav-tabs"},[t._m(0),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(n){return e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link",attrs:{"data-toggle":"tab",href:"#"+n.tabLink}},[t._v(t._s(n.tab))])])})):t._e()],2),t._v(" "),e("div",{staticClass:"tab-content"},[e("p",[t._v(" ")]),t._v(" "),e("div",{staticClass:"tab-pane fade active show",attrs:{id:"description"}},[e("div",{staticClass:"form"},[t._t("default",[t._l(t.formData,(function(t,n){return[e("div",[e("detail-field",{key:"main_data_field"+n,attrs:{component:t}})],1)]}))],{default:t.formData})],2)]),t._v(" "),t.additionalComponents&&t.item.id?t._l(t.additionalComponents,(function(n,a){return e("div",{staticClass:"tab-pane fade",attrs:{id:n.tabLink}},["one.to.one"!==n.type?e("div",[t._l(n.dataConfig,(function(i,o){return e("div",[n.isViewOnly?t._e():e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(n){return t.deleteAdditionalData(a,o)}}},[t._v("Удалить")]),t._v(" "),t._l(i,(function(t,n){return[e("div",[e("detail-field",{key:"data_component"+n,ref:"detail_field_"+t.field+"_"+n+"_"+o,refInFor:!0,attrs:{"data-index":o,index:n,component:t}})],1)]})),t._v(" "),e("hr")],2)})),t._v(" "),n.isViewOnly?t._e():e("button",{staticClass:"btn btn-primary",staticStyle:{"margin-top":"10px"},attrs:{type:"button"},on:{click:function(e){return t.addAdditionalData(a,n.initialConfig)}}},[t._v("Добавить")])],2):e("div",t._l(n.dataConfig,(function(n){return e("div",[t._l(n,(function(t,n){return[e("div",[e("detail-field",{key:"data_component"+n,attrs:{component:t}})],1)]}))],2)})),0)])})):t._e()],2),t._v(" "),e("p",[t._v(" ")]),t._v(" "),t.detailConfig.nobuttons?t._e():e("div",[e("button",{staticClass:"btn btn-success",on:{click:t.save}},[e("i",{staticClass:"fa fa-save"}),t._v("\n            Сохранить\n        ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",on:{click:t.apply}},[t._v("\n            Применить\n        ")]),t._v(" "),this.id?e("button",{staticClass:"btn btn-danger",on:{click:t.deleteItem}},[t._v("\n            Удалить\n        ")]):t._e()])])}),[function(){var t=this.$createElement,n=this._self._c||t;return n("li",{staticClass:"nav-item active"},[n("a",{staticClass:"nav-link active",attrs:{"data-toggle":"tab",href:"#description"}},[this._v("Основное")])])}],!1,null,"7b31b052",null);n.default=o.exports}}]);
//# sourceMappingURL=6.js.map